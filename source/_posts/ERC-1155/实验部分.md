**第五章 实验设计与评估**

本章旨在对所提出的以太坊隐式监管机制进行系统性评估，既包括功能正确性的验证，也包括在不同规模交易网络下对性能开销的量化分析。实验基于单节点私有链环境搭建，在相同链配置下分别运行原生 Geth 客户端与改造后的监管版 Geth（以下简称 Reg-Geth），通过对同一批交易的重复回放，比较两者在功能一致性与性能指标上的差异。

**5.1 实验目标**
 本次实验的首要目标在于验证所提出的监管机制能否在链上实时准确地进行风险传播与风险分数维护，使得最终链上风险状态与离线基准计算结果一致。其次，在确保功能正确性的前提下，实验旨在量化 Reg-Geth 相较于原生 Geth 在交易延迟、吞吐率（TPS）和 Gas 消耗等关键性能指标上的开销，并分析在交易规模扩大的情况下，这些开销的变化趋势。

**5.2 实验环境**
 实验平台为单节点以太坊私有链环境，执行客户端为基于 Geth v1.16.2 源码修改后的 Reg-Geth，以及未作改动的原生 Geth 版本。两者在链参数（如出块时间、Gas 上限）与账户初始状态上保持一致。
 链上部署两类核心合约：（1）监管合约 *RegulatoryContract*，实现敏感函数注册、白名单管理、风险分数更新等逻辑；（2）符合 ERC-20 标准的 *CompliantERC20Token*，其 `transfer` 方法已在监管合约中注册为敏感函数，并将该合约地址加入白名单，从而可在监管机制下正常调用。

**5.3 实验方法**
 为了模拟多账户之间的代币流转与风险扩散过程，实验首先利用随机图生成算法构造交易网络。网络的节点集合代表账户，边集合代表代币转账行为，并指定一个风险源账户（A1）作为初始风险分值的持有者。离线风险传播规则按交易顺序逐步传播风险值，每经过一次转账，风险值衰减 1，仅在新风险值高于当前风险分值时更新目标账户的分值。该离线计算结果作为基准，用于功能正确性验证。
 实验流程如下：首先为交易网络中的每个节点生成唯一的链上账户，并由 Owner 账户向其分发固定数量的代币与足够支付交易费用的以太币；随后严格按照网络中边的顺序串行回放每一笔 `transfer` 交易，期间记录交易延迟、Gas 消耗等原始数据。交易全部回放完成后，读取链上 *RegulatoryContract* 中各账户的风险分数，并与离线基准进行逐一对比，以计算功能准确率。
 上述流程在 Reg-Geth 与原生 Geth 两种环境中分别执行，保证交易数据与执行顺序完全一致，以便进行公平对比。

转账网络示意图：

![image-20250807154338092](https://gitee.com/Cishoon/pic-bed/raw/master/202508101112099.png)

![image-20250807154330363](https://gitee.com/Cishoon/pic-bed/raw/master/202508101112431.png)

**5.4 指标定义**
 为了全面评估系统性能与功能表现，本实验定义以下指标：

- **平均交易时间**：从交易提交到获得链上确认回执的端到端平均耗时，反映交易执行延迟。

- **吞吐率（TPS）**：单位时间内成功执行的交易数，计算公式为

    TPS=成功交易总数交易回放总耗时
    $$
    \mathrm{TPS} = \frac{\text{成功交易总数}}{\text{交易回放总耗时}}
    $$
    
- **平均 Gas 消耗**：所有成功交易的 `gasUsed` 值的平均数，衡量单笔交易在计算与存储资源上的成本。

- **功能准确率（Acc）**：功能验证指标，表示链上最终风险分值与离线基准一致的账户比例，定义为

    Acc=风险分值一致的账户数账户总数
    $$
    \mathrm{Acc} = \frac{\text{风险分值一致的账户数}}{\text{账户总数}}
    $$
    对未开启监管机制的原生 Geth，由于不执行链上风险传播，功能准确率不作统计。

**5.5 实验结果与分析**

小规模网络（30 节点，40边）

| 场景                       | 总交易 | 成功 | 失败 | 平均交易时间 (ms) | TPS   | 平均 Gas | 准确率      |
| -------------------------- | ------ | ---- | ---- | ----------------- | ----- | -------- | ----------- |
| **Reg-Geth（有监管）**     | 40     | 40   | 0    | 90.40             | 11.06 | 35051    | **100.00%** |
| **Vanilla-Geth（无监管）** | 40     | 40   | 0    | 90.33             | 11.07 | 35055    | -           |

大规模网络（300 节点，1000 边）

| 场景                       | 总交易 | 成功 | 失败 | 平均交易时间 (ms) | TPS   | 平均 Gas | 准确率      |
| -------------------------- | ------ | ---- | ---- | ----------------- | ----- | -------- | ----------- |
| **Reg-Geth（有监管）**     | 1000   | 1000 | 0    | 102.67            | 9.74  | 35054    | **100.00%** |
| **Vanilla-Geth（无监管）** | 1000   | 1000 | 0    | 99.56             | 10.04 | 35054    | —           |

 在小规模交易网络（30 个节点，40 条转账边）中，Reg-Geth 的功能准确率达到 100%，链上风险分布与离线基准完全一致；平均交易时间与原生 Geth 基本持平（约 90ms），TPS 约为 11，Gas 消耗差异在统计误差范围内。
 在大规模交易网络（300 个节点，1000 条转账边）中，Reg-Geth 同样保持 100% 的功能准确率，TPS 相较原生 Geth 下降约 3%（10.04 → 9.74），平均交易延迟增加约 3ms，Gas 消耗仍基本一致。这表明监管逻辑在链上执行所带来的额外性能开销可控，主要来自于监管调用路径与状态访问，而非大量的额外链上计算。

**5.6 小结**
 实验结果表明，所提出的隐式监管机制能够在链上实现与离线计算一致的风险传播结果，并在保持较高性能的同时提供可验证的风控能力。在交易规模扩大至 1000 笔时，系统性能仅出现轻微下降，证明了该方法在实际应用中具有良好的可扩展性与工程可行性。

