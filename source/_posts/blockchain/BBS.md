---
title: BLS，BBS与其数学基础
categories: [笔记]
tags: [区块链, 密码学, 数学, 离散数学, 群论]
date: 2025-09-17
---

花点时间研究BLS，BBS，BBS+的算法。

<!--more-->

# 数学基础

## 0 群

一个**群（group）**，可以理解为一个集合 $G$ 搭配一个运算“$\ast$”（比如加法、乘法），需要满足四条规则：

1. **封闭性**：任取 $a,b \in G$，计算 $a\ast b$ 仍然在 $G$ 里。
2. **结合律**：$(a\ast b)\ast c = a\ast (b\ast c)$。
3. **单位元**：存在一个特殊元素 $e \in G$，使得对任意 $a \in G$，有 $a\ast e = e\ast a = a$。
4. **逆元**：对任意 $a \in G$，存在一个 $a^{-1}$，使得 $a\ast a^{-1} = a^{-1}\ast a = e$。



## 1 循环群

一个群 $G$ 称为**循环群**，如果存在一个元素 $g \in G$，使得群中**每一个元素**都可以写成 $g$ 的幂次：
$$
G = \{ g^0, g^1, g^2, \dots, g^{n-1} \}
$$
其中 $n$ 是群的**阶**（即元素个数），并且有 $g^n = e$（回到单位元）。

这个特殊的元素 $g$，叫做**生成元（generator）**。



例子：**模 7 加法群**

集合：$\{0,1,2,3,4,5,6\}$，运算是“模 7 加法”。

- 生成元可以是 1，因为
    $$
    0, 1, (1+1)\bmod 7=2, (1+1+1)\bmod 7=3, \dots, 6
    $$
    就把整个集合生成了。
    所以 $\mathbb{Z}_7$ 是一个循环群。



“设 $G=\langle g\rangle$ 是阶为 $n$ 的循环群”：

- $G$：一个群；
- $\langle g\rangle$：表示由元素 $g$ 生成的群（即所有 $g^k$ 的集合）；
- “阶为 $n$”：群里总共有 $n$ 个不同的元素；
- 总结：$G$ 是一个循环群，它的所有元素都能写成 $g^k$ 的形式，且一共 $n$ 个。



### 1.1 有限域乘法群 $\mathbb{F}_p$

- 设 $p$ 是一个素数；
- $\mathbb{F}_p = \{0,1,2,\dots,p-1\}$，运算是模 $p$ 加法和模 $p$ 乘法；
- $\mathbb{F}_p$ 称为**有限域**，因为它是一个有限的数集，且加减乘除（除零外）都有意义。



- 考虑非零元素：$\mathbb{F}_p^\* = \{1,2,\dots,p-1\}$，在模 $p$ 乘法下形成一个群；

- 群的阶是 $p-1$（因为零被排除）。

- 重要事实：$\mathbb{F}_p^\*$ 是一个**循环群**。

    - 意味着存在一个生成元 $g$，使得
        $$
        \mathbb{F}_p^\* = \{ g^1, g^2, \dots, g^{p-1} \} \pmod p
        $$



取 $p=7$：$\mathbb{F}_7^\* = \{1,2,3,4,5,6\}$。

- 生成元 $g=3$：
    $$
    3^1=3,\; 3^2=2,\; 3^3=6,\; 3^4=4,\; 3^5=5,\; 3^6=1 \pmod{7}
    $$

- 所有元素都能生成，所以 3 是一个原根（primitive root）。



### 1.2 椭圆曲线群

#### 椭圆曲线方程

- 在有限域 $\mathbb{F}_p$ 上定义曲线：
    $$
    E: y^2 \equiv x^3 + ax + b \pmod p
    $$
    其中参数 $a,b \in \mathbb{F}_p$，且满足判别式 $4a^3 + 27b^2 \not\equiv 0 \pmod p$，保证曲线“非奇异”。

- 曲线上的点集合：
    $$
    E(\mathbb{F}_p) = \{ (x,y)\in \mathbb{F}_p^2 \mid y^2 \equiv x^3+ax+b \} \cup \{\mathcal{O}\}
    $$
    其中 $\mathcal{O}$ 是“无穷远点”，充当群的单位元。



#### 群运算（点加法）

- 定义了一个“点加法”运算 $\oplus$，满足群的四条性质。
- 直观几何解释（在实数域里）：
    - 过点 $P,Q$ 作直线，交椭圆曲线于第三点 $R$，再取其对称点 $-R$，定义为 $P+Q$。
- 在有限域上，这个过程转化为代数公式（斜率、模逆元等）。





## 2 离散对数问题（DLP）

### 2.1 定义

在素数阶循环群 $G=\langle g\rangle$ 上：

- **离散对数问题（DLP）**：给定 $g, y=g^x$，求 $x$。

### 2.2 为什么难解？

**没有闭式公式**
在实数域里，$\log$ 是指数函数的反函数；但在模运算下（有限域/椭圆曲线），不存在类似的解析反函数。

**指数运算像“乱洗牌”**
当模数 $p$ 很大时，序列 $g^1,g^2,\dots$ 在 $\mathbb{F}_p^\*$ 看起来几乎是随机均匀分布的。已知一个值 $y$，几乎没有比**逐一尝试**更快的方法。

**暴力搜索代价巨大**
群阶若为 $n$，最笨的办法是试 $g^1,g^2,\dots,g^n$，复杂度 $O(n)$。如果 $n$ 大约是 $2^{256}$，即便用超级计算机也完全不可能。



**通用攻击（不依赖群结构）**

- **Baby-Step Giant-Step (BSGS)**：时间与空间都是 $O(\sqrt{n})$。
- **Pollard ρ**：时间 $O(\sqrt{n})$，空间极小 → 实际攻击基线。

**特殊攻击（利用群结构）**

- **有限域 $\mathbb{F}_p^\*$**：有 **次指数算法**（Index Calculus / Number Field Sieve for DLP）。
    - 复杂度约 $\exp((\log p)^{1/3}(\log\log p)^{2/3})$，比 $\sqrt{p}$ 快得多。
    - 👉 因此在有限域上必须用很大的 $p$（如 3072 位）才能达到 128-bit 安全。
- **椭圆曲线群 ECDLP**：目前没有次指数算法，最好的还是 $O(\sqrt{n})$（Pollard ρ）。
    - 👉 因此 256 位阶的曲线群就能提供 ~128-bit 安全，比有限域高效很多。



## 3 双线性群（bilinear group）

一个 **双线性群系统** 通常由三部分组成：
$$
(G_1, G_2, G_T, e)
$$

- $G_1, G_2, G_T$：都是阶为大素数 $p$ 的循环群；
- $g_1 \in G_1, g_2 \in G_2$：生成元；
- $e: G_1 \times G_2 \to G_T$：一个**双线性映射**（bilinear map，也叫“配对”）。

e 必须满足以下三个条件：

1. **双线性（bilinearity）**
     对所有 $u\in G_1, v\in G_2, a,b\in \mathbb{Z}_p$，有
     $$
     e(u^a, v^b) = e(u,v)^{ab}
     $$
     👉 这条性质最重要：指数“乘”在映射里变成了“指数积”。

2. **非退化性（non-degeneracy）**
    $$
    e(g_1, g_2) \neq 1
    $$
    否则映射就没信息量。

3. **有效可计算（computability）**
     给定 $u\in G_1, v\in G_2$，能在多项式时间内算出 $e(u,v)$。

可以根据定义推导出 $G_1 \rightarrow G_T$ 和 $G_2 \rightarrow G_T$ 是群同态的。

### 群同态

设有两个群：

- 群 $G$，运算写作 $\cdot$，单位元记作 $e_G$。
- 群 $H$，运算写作 $*$，单位元记作 $e_H$。

一个函数 $f: G \to H$ 如果满足：
$$
f(a \cdot b) = f(a) * f(b),\quad \forall a,b \in G,
$$
就叫做 **群同态**。

直观理解，可以把群同态理解成一个“保持结构的变换”：

- 在原群里做运算，再映射；
- 和先映射，再在目标群里运算，结果一样。



### 推导

在双线性群中有配对映射
$$
e: G_1 \times G_2 \to G_T.
$$
**固定第二个参数** $v\in G_2$，得到一个函数：
$$
f_v: G_1 \to G_T,\quad f_v(u)=e(u,v).
$$
要验证它是群同态：
$$
\begin{align}
f_v(u_1 \cdot u_2) &= e(u_1\cdot u_2, v) \\ 
&= e(g_1^a \cdot g_1^b, v) \\
&= e(g_1^{a+b}, v) \\
&= e(g_1, v)^{a+b} \\
&= e(g_1, v)^ae(g_1, v)^b \\
&= e(g_1^a, v)e(g_1^b,v)\\
&= e(u_1,v)\cdot e(u_2,v) = f_v(u_1)\cdot f_v(u_2).
\end{align}
$$


## 4 强 Diffie–Hellman 假设（q-SDH）

### 4.1 普通 Diffie–Hellman 假设

- **计算型 Diffie–Hellman（CDH）**：给定 $(g, g^a, g^b)$，**计算** $g^{ab}$。
- **判定型 Diffie–Hellman（DDH）**：给定 $(g, g^a, g^b, g^c)$，**判断** $c\stackrel{?}=ab$。

这些假设都基于**离散对数问题的难解性**。

无法通过 $y = g^x$ 推导出 $x = log_gy$  。没有多项式时间内的对数运算。



### 4.2 强 Diffie–Hellman (q-SDH) 假设的定义

**SDH 假设**是在 **双线性群（bilinear group）** 上定义的，常用于群签名、短签名等方案。

- 设 $G$ 是一个阶为质数 $p$ 的循环群，生成元为 $g$。

- 给定一个秘密数 $x \in \mathbb{Z}_p^*$，公开 $(g, g^x, g^{x^2}, \dots, g^{x^q})$。

- **问题**：在不知道 $x$ 的情况下，计算任意形式为
    $$
    (c, g^{\frac{1}{x+c}})
    $$
    的对，其中 $c \in \mathbb{Z}_p$ 自由选择。

**q-SDH 假设**：认为在公开 $(g, g^x, g^{x^2}, \dots, g^{x^q})$ 的条件下，任何多项式时间的算法几乎不可能输出一个新的合法对 $(c, g^{1/(x+c)})$。



# BLS

## 1 直觉

选择大素数 $p$ 的三个循环群：$G_1, G_2, G_T$，阶均为 $p$。

生成元：$g_1\in G_1$，$g_2\in G_2$。

配对：$e: G_1\times G_2\to G_T$，双线性、非退化、可计算。

**哈希到曲线**：$H:\{0,1\}^\*\to G_1$（或到 $G_2$），把消息映射到群点（需用正规 hash-to-curve 方案）。

> 假设签名在 $G_1$、公钥在 $G_2$；



BLS 的核心是利用**双线性配对**把“指数上的乘法”显式化：

若 $e$ 是配对，满足 $e(g^a, h^b)=e(g,h)^{ab}$。

令签名 $\sigma=H(m)^{x}$（在某个群里），公钥 $pk=g^{x}$（在另一个群里），则验证：
$$
e(\sigma, g) \stackrel{?}{=} e(H(m), pk)
$$
因为左边 $=e(H(m)^x,g)=e(H(m),g)^x$，右边 $=e(H(m),g^x)$，两边相等说明确由同一私钥 $x$ 产生。





## 2 流程

- **密钥生成**

    选私钥 $x \xleftarrow{\$}\mathbb{Z}_p^\*$。

    公钥 $pk=g_2^{x}$（若签名在 $G_1$）。

- **签名**（消息 $m$）

    1. $P \leftarrow H(m)\in G_1$。将消息哈希到曲线。
    2. $\sigma \leftarrow P^{x}\in G_1$。

- **检查**
    $$
    e(\sigma, g_2) = e(H(m)^x, g_2) = e(H(m), g_2^x) = e(H(m), pk)
    $$
    检查方拿到签名 $\sigma$ 和消息$m$ ，已知 $g_2$ 和 $pk$ ，即可验证签名是否正确。



## 3 聚合签名

### 设定与符号

- 配对群：$(G_1,G_2,G_T,e)$，阶为素数 $p$，生成元 $g_1\in G_1, g_2\in G_2$。
- 哈希到曲线：$H:\{0,1\}^\*\to G_1$（也可反过来放到 $G_2$，下同）。
- 第 $i$ 个签名者私钥 $x_i\in\mathbb{Z}_p^\*$，公钥 $pk_i=g_2^{x_i}$。
- 对消息 $m$ 的 BLS 签名：$\sigma=H(m)^{x}\in G_1$。



### 输入

一批三元组 $(pk_i, m_i, \sigma_i)$，其中
$$
\sigma_i = H(m_i)^{x_i}\in G_1
$$

### 聚合

$$
\boxed{\;\sigma_{\text{agg}}=\prod_{i=1}^n \sigma_i\;}\quad\in G_1.
$$

这就是把各签名（群元素）相乘（椭圆曲线是“点加/标量乘”的对应群运算；在 $G_1$ 里用群运算累乘即可）。

### 验证

$$
\begin{aligned}
e(\sigma_{\text{agg}}, g_2)
&=e\!\Big(\prod_i H(m_i)^{x_i},\, g_2\Big)
=\prod_i e\!\left(H(m_i)^{x_i}, g_2\right)\\
&=\prod_i e\!\left(H(m_i), g_2\right)^{x_i}
=\prod_i e\!\left(H(m_i), g_2^{x_i}\right)
=\prod_i e\!\left(H(m_i), pk_i\right).
\end{aligned}
$$



## 4 为什么聚合签名验证更快

> 具体公式推导没有看懂，总之可以分成两种运算，其中可合并ML后运算FE。

对单个配对 $e(P,Q)$ 来说：

1. **Miller loop (ML)**：算出 $f_{r,Q}(P) \in \mathbb{F}_{p^k}^\*$，但它还没在目标子群 $G_T$；

2. **Final exp (FE)**：把结果提到指数 $(p^k-1)/r$，得到
    $$
    e(P,Q) = f_{r,Q}(P)^{(p^k-1)/r}\in G_T.
    $$

所以配对的“真正结果” = ML 输出 + 一次 FE。



对于逐个验证：
$$
e(\sigma_i, g_2) = e(H(m_i), pk_i)
$$
需要做 2n 次 ML + 2n 次 FE。



而聚合签名：
$$
e(\sigma_{agg},g_2) = \prod_ie(H(m_i), pk_i)
$$
左侧做 1次ML + 1次FE，右侧可合并ML后做FE，即 n 次 ML + 1次 FE。
总共 n+1 次ML + 2次 FE。



